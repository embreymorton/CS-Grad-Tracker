#!/usr/bin/env node

// Edit this place to set the port number and ip addess of the server that is running the application.
// It defaults to localhost:3000
var mongoose = require('mongoose')
mongoose.Promise = require('bluebird')

var app = require('../app.js')

global.server = {}

var connectionString = null
if (process.env.MONGODB_PASSWORD) {
  var mongoServiceName = process.env.DATABASE_SERVICE_NAME.toUpperCase()
  connectionString = 'mongodb://' +
    process.env.MONGODB_USER + ':' +
    process.env.MONGODB_PASSWORD + '@' +
    process.env[mongoServiceName + '_SERVICE_HOST'] + ':' +
    process.env[mongoServiceName + '_SERVICE_PORT'] + '/' +
    process.env.MONGODB_DATABASE
}

var config = require('../config.js');

mongoose.connect(config[process.env.mode], {useNewUrlParser: true, useUnifiedTopology: true})
mongoose.connection
  .on('error', console.error.bind(console, 'connection error:'))
  .once('open', function () {
    console.log("App running at ");
    global.server = app.listen(config.port, config.host)
  })
